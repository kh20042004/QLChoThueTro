# ğŸ  QLChoThueTro - Há»‡ Thá»‘ng Cho ThuÃª NhÃ /PhÃ²ng Trá»

![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)
![MongoDB](https://img.shields.io/badge/MongoDB-5.0+-brightgreen.svg)
![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

Há»‡ thá»‘ng web hiá»‡n Ä‘áº¡i cho thuÃª nhÃ , phÃ²ng trá», cÄƒn há»™ táº¡i Viá»‡t Nam vá»›i tÃ­ch há»£p **AI**, **Machine Learning** vÃ  **Real-time Chat**.

## ğŸ“‹ Má»¥c Lá»¥c

- [TÃ­nh NÄƒng ChÃ­nh](#-tÃ­nh-nÄƒng-chÃ­nh)
- [Tech Stack](#-tech-stack)
- [YÃªu Cáº§u Há»‡ Thá»‘ng](#-yÃªu-cáº§u-há»‡-thá»‘ng)
- [CÃ i Äáº·t](#-cÃ i-Ä‘áº·t)
- [Cáº¥u HÃ¬nh](#-cáº¥u-hÃ¬nh)
- [Cháº¡y á»¨ng Dá»¥ng](#-cháº¡y-á»©ng-dá»¥ng)
- [Cáº¥u TrÃºc Dá»± Ãn](#-cáº¥u-trÃºc-dá»±-Ã¡n)
- [API Endpoints](#-api-endpoints)
- [Machine Learning](#-machine-learning)
- [TÃ i Khoáº£n Demo](#-tÃ i-khoáº£n-demo)
- [Screenshots](#-screenshots)
- [Contributing](#-contributing)
- [License](#-license)

---

## âœ¨ TÃ­nh NÄƒng ChÃ­nh

### ğŸ¯ Chá»©c NÄƒng CÆ¡ Báº£n
- âœ… **ÄÄƒng kÃ½/ÄÄƒng nháº­p** - Email/Password + OAuth Google
- âœ… **Quáº£n lÃ½ bÃ i Ä‘Äƒng** - CRUD phÃ²ng trá»/nhÃ  vá»›i upload nhiá»u áº£nh
- âœ… **TÃ¬m kiáº¿m nÃ¢ng cao** - Lá»c theo giÃ¡, vá»‹ trÃ­, diá»‡n tÃ­ch, tiá»‡n Ã­ch
- âœ… **Báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c** - Hiá»ƒn thá»‹ vá»‹ trÃ­ phÃ²ng trÃªn Goong Maps
- âœ… **Äáº·t phÃ²ng/Xem phÃ²ng** - Há»‡ thá»‘ng booking hoÃ n chá»‰nh
- âœ… **ÄÃ¡nh giÃ¡ & Review** - NgÆ°á»i dÃ¹ng Ä‘Ã¡nh giÃ¡ phÃ²ng/chá»§ nhÃ 

### ğŸ¤– AI & Machine Learning
- ğŸ§  **AI Chatbot** - Trá»£ lÃ½ áº£o tÆ° váº¥n 24/7 (Google Gemini 2.5 Flash + Groq)
- ğŸ” **TÃ¬m kiáº¿m NLP** - Hiá»ƒu ngÃ´n ngá»¯ tá»± nhiÃªn ("phÃ²ng gáº§n ÄH CÃ´ng Nghá»‡")
- ğŸ“Š **Dá»± Ä‘oÃ¡n giÃ¡** - ML model dá»± Ä‘oÃ¡n giÃ¡ phÃ²ng há»£p lÃ½ (XGBoost)
- ğŸ›¡ï¸ **Kiá»ƒm duyá»‡t tá»± Ä‘á»™ng** - PhÃ¡t hiá»‡n spam & bÃ i Ä‘Äƒng báº¥t thÆ°á»ng (Isolation Forest)

### ğŸ’¬ Real-time Features
- ğŸ’¬ **Chat real-time** - WebSocket giá»¯a chá»§ nhÃ  & ngÆ°á»i thuÃª (Socket.IO)
- ğŸ”” **ThÃ´ng bÃ¡o instant** - Cáº­p nháº­t sá»± kiá»‡n quan trá»ng ngay láº­p tá»©c
- ğŸ‘¥ **Tráº¡ng thÃ¡i online/offline** - Hiá»ƒn thá»‹ user Ä‘ang online

### ğŸ¨ Giao Diá»‡n & UX
- ğŸ“± **Responsive design** - TÆ°Æ¡ng thÃ­ch mobile, tablet, desktop
- ğŸ¨ **Tailwind CSS** - UI hiá»‡n Ä‘áº¡i, Ä‘áº¹p máº¯t
- âš¡ **Fast loading** - Compression, image optimization

---

## ğŸ› ï¸ Tech Stack

### Backend
```
Node.js 18+      Express.js      MongoDB (Mongoose)
JWT Auth         Passport.js     Socket.IO
Multer           Cloudinary      Nodemailer
```

### Frontend
```
HTML5            CSS3            Tailwind CSS
JavaScript ES6+  Axios           Goong Maps API
Font Awesome
```

### AI & Machine Learning
```
Python 3.8+      Flask           Google Gemini API
Groq API         XGBoost         Isolation Forest
scikit-learn     pandas          numpy
```

### DevOps & Tools
```
Git              Nodemon         PM2
Winston          Helmet          Morgan
```

---

## ğŸ’» YÃªu Cáº§u Há»‡ Thá»‘ng

### Node.js Application
- **Node.js**: 18.x trá»Ÿ lÃªn
- **MongoDB**: 5.0 trá»Ÿ lÃªn (hoáº·c MongoDB Atlas)
- **npm** hoáº·c **yarn**

### ML Service (Optional)
- **Python**: 3.8 trá»Ÿ lÃªn
- **pip**: Package manager

### API Keys Cáº§n Thiáº¿t
- MongoDB URI (MongoDB Atlas hoáº·c local)
- Google Gemini API Key
- Groq API Key (optional, dÃ¹ng lÃ m fallback)
- Cloudinary Account (image storage)
- Goong Maps API Key (báº£n Ä‘á»“ Viá»‡t Nam)
- Email SMTP (Gmail hoáº·c service khÃ¡c)

---

## ğŸ“¦ CÃ i Äáº·t

### 1. Clone Repository

```bash
git clone https://github.com/kh20042004/QLChoThueTro.git
cd QLChoThueTro
```

### 2. CÃ i Äáº·t Dependencies

#### Backend (Node.js)
```bash
npm install
```

#### ML Service (Python) - Optional
```bash
cd ml-moderation/scripts
pip install -r requirements.txt
cd ../api
pip install -r requirements.txt
cd ../..
```

### 3. Cáº¥u HÃ¬nh Environment Variables

Táº¡o file `.env` á»Ÿ thÆ° má»¥c root:

```env
# ===================================
# SERVER CONFIGURATION
# ===================================
NODE_ENV=development
PORT=3000
CLIENT_URL=http://localhost:3000

# ===================================
# DATABASE
# ===================================
MONGODB_URI=mongodb://localhost:27017/qlchothuetro
# Hoáº·c dÃ¹ng MongoDB Atlas:
# MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/qlchothuetro

# ===================================
# JWT AUTHENTICATION
# ===================================
JWT_SECRET=your-super-secret-jwt-key-change-this
JWT_EXPIRE=7d
JWT_COOKIE_EXPIRE=7

# ===================================
# SESSION
# ===================================
SESSION_SECRET=your-session-secret-key

# ===================================
# OAUTH GOOGLE
# ===================================
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:3000/api/auth/google/callback

# ===================================
# EMAIL SERVICE (Gmail)
# ===================================
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_SECURE=false
MAIL_USER=your-email@gmail.com
MAIL_PASSWORD=your-app-password

# ===================================
# AI SERVICES
# ===================================
# Google Gemini API
GEMINI_API_KEY=your-gemini-api-key

# Groq API (Fallback)
GROQ_API_KEY=your-groq-api-key

# ===================================
# CLOUDINARY (Image Storage)
# ===================================
CLOUDINARY_NAME=your-cloudinary-name
CLOUDINARY_API_KEY=your-cloudinary-api-key
CLOUDINARY_API_SECRET=your-cloudinary-api-secret

# ===================================
# GOONG MAPS API (Vietnam Maps)
# ===================================
GOONG_API_KEY=your-goong-api-key
GOONG_MAPTILES_KEY=your-goong-maptiles-key

# ===================================
# ML SERVICE
# ===================================
ML_MODERATION_URL=http://localhost:5000
```

---

## âš™ï¸ Cáº¥u HÃ¬nh

### HÆ°á»›ng Dáº«n Láº¥y API Keys

#### 1. MongoDB Atlas (Free)
1. Truy cáº­p [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. ÄÄƒng kÃ½ tÃ i khoáº£n miá»…n phÃ­
3. Táº¡o cluster má»›i
4. Láº¥y connection string
5. Thay `<password>` vÃ  `<dbname>` trong URI

#### 2. Google Gemini API
1. Truy cáº­p [Google AI Studio](https://makersuite.google.com/app/apikey)
2. ÄÄƒng nháº­p báº±ng Google Account
3. Táº¡o API key má»›i
4. Copy key vÃ o `.env`

#### 3. Groq API (Optional)
1. Truy cáº­p [Groq Console](https://console.groq.com/)
2. ÄÄƒng kÃ½ tÃ i khoáº£n
3. Táº¡o API key
4. Copy key vÃ o `.env`

#### 4. Cloudinary
1. Truy cáº­p [Cloudinary](https://cloudinary.com/)
2. ÄÄƒng kÃ½ tÃ i khoáº£n miá»…n phÃ­
3. VÃ o Dashboard â†’ Account Details
4. Copy Cloud Name, API Key, API Secret

#### 5. Goong Maps API
1. Truy cáº­p [Goong.io](https://goong.io/)
2. ÄÄƒng kÃ½ tÃ i khoáº£n
3. Táº¡o API key má»›i
4. Láº¥y cáº£ API Key vÃ  Maptiles Key

#### 6. Gmail SMTP
1. Báº­t "2-Step Verification" trong Google Account
2. Táº¡o "App Password":
   - Google Account â†’ Security â†’ 2-Step Verification â†’ App passwords
3. Chá»n app: Mail, device: Other
4. Copy password 16 kÃ½ tá»± vÃ o `.env`

---

## ğŸš€ Cháº¡y á»¨ng Dá»¥ng

### Cháº¡y MongoDB (Local)

```bash
# Windows
mongod

# Linux/Mac
sudo systemctl start mongod
```

### Cháº¡y Backend Server

#### Development Mode (Auto-reload)
```bash
npm run dev
```

#### Production Mode
```bash
npm start
```

Server sáº½ cháº¡y táº¡i: **http://localhost:3000**

### Cháº¡y ML Service (Optional)

```bash
cd ml-moderation/api
python app.py
```

ML Service sáº½ cháº¡y táº¡i: **http://localhost:5000**

### Seed Database (Optional)

```bash
# Seed danh sÃ¡ch trÆ°á»ng Ä‘áº¡i há»c
npm run seed-universities
```

---

## ğŸ“ Cáº¥u TrÃºc Dá»± Ãn

```
QLChoThueTro/
â”œâ”€â”€ server.js                 # Entry point
â”œâ”€â”€ package.json              # Dependencies
â”œâ”€â”€ .env                      # Environment variables (táº¡o má»›i)
â”œâ”€â”€ .gitignore               # Git ignore rules
â”‚
â”œâ”€â”€ src/                      # Source code chÃ­nh
â”‚   â”œâ”€â”€ app.js               # Express app setup
â”‚   â”œâ”€â”€ config/              # Cáº¥u hÃ¬nh (DB, Cloudinary, Passport)
â”‚   â”œâ”€â”€ models/              # Database schemas (8 models)
â”‚   â”œâ”€â”€ controllers/         # Business logic (12 controllers)
â”‚   â”œâ”€â”€ routes/              # API endpoints (13 routes)
â”‚   â”œâ”€â”€ services/            # Business services (AI, Email, Moderation...)
â”‚   â”œâ”€â”€ middleware/          # Auth, Error handling, Upload
â”‚   â””â”€â”€ socket/              # WebSocket chat handler
â”‚
â”œâ”€â”€ public/                   # Static files
â”‚   â”œâ”€â”€ css/                 # Stylesheets
â”‚   â”œâ”€â”€ js/                  # Frontend JavaScript
â”‚   â”œâ”€â”€ images/              # Static images
â”‚   â””â”€â”€ uploads/             # User uploads (ignored by git)
â”‚
â”œâ”€â”€ views/                    # HTML templates
â”‚   â”œâ”€â”€ index.html           # Trang chá»§
â”‚   â”œâ”€â”€ properties.html      # Danh sÃ¡ch phÃ²ng
â”‚   â”œâ”€â”€ property-detail.html # Chi tiáº¿t phÃ²ng
â”‚   â”œâ”€â”€ chat.html            # Chat
â”‚   â”œâ”€â”€ auth/                # Login, Register
â”‚   â”œâ”€â”€ admin/               # Admin panel
â”‚   â””â”€â”€ partials/            # Reusable components
â”‚
â””â”€â”€ ml-moderation/            # Machine Learning Service
    â”œâ”€â”€ api/                  # Flask API server
    â”‚   â”œâ”€â”€ app.py           # Main Flask app
    â”‚   â”œâ”€â”€ moderation_service.py
    â”‚   â”œâ”€â”€ ml_predictor.py
    â”‚   â””â”€â”€ requirements.txt
    â”œâ”€â”€ models/               # Trained ML models
    â”œâ”€â”€ data/                 # Training data
    â”œâ”€â”€ scripts/              # Training scripts
    â”‚   â”œâ”€â”€ 1_data_preparation.py
    â”‚   â”œâ”€â”€ 2_train_price_model.py
    â”‚   â”œâ”€â”€ 3_train_anomaly_model.py
    â”‚   â””â”€â”€ run_all.py
    â””â”€â”€ notebooks/            # Jupyter notebooks
```

---

## ğŸ”Œ API Endpoints

### Authentication
```
POST   /api/auth/register          ÄÄƒng kÃ½ tÃ i khoáº£n
POST   /api/auth/login             ÄÄƒng nháº­p
GET    /api/auth/logout            ÄÄƒng xuáº¥t
GET    /api/auth/me                Láº¥y thÃ´ng tin user hiá»‡n táº¡i
PUT    /api/auth/profile           Cáº­p nháº­t há»“ sÆ¡
GET    /api/auth/google            OAuth Google login
```

### Properties
```
GET    /api/properties             Danh sÃ¡ch bÃ i Ä‘Äƒng (filter, sort, pagination)
GET    /api/properties/:id         Chi tiáº¿t bÃ i Ä‘Äƒng
POST   /api/properties             Táº¡o bÃ i Ä‘Äƒng (auth required)
PUT    /api/properties/:id         Chá»‰nh sá»­a bÃ i Ä‘Äƒng
DELETE /api/properties/:id         XÃ³a bÃ i Ä‘Äƒng
GET    /api/properties/my-properties    BÃ i Ä‘Äƒng cá»§a tÃ´i
```

### Bookings
```
GET    /api/bookings               Danh sÃ¡ch booking
POST   /api/bookings               Táº¡o booking má»›i
PUT    /api/bookings/:id           Cáº­p nháº­t booking
PATCH  /api/bookings/:id/confirm   XÃ¡c nháº­n booking
PATCH  /api/bookings/:id/cancel    Há»§y booking
```

### Reviews
```
GET    /api/reviews/property/:id   ÄÃ¡nh giÃ¡ cá»§a bÃ i Ä‘Äƒng
POST   /api/reviews                Táº¡o Ä‘Ã¡nh giÃ¡
PUT    /api/reviews/:id            Chá»‰nh sá»­a Ä‘Ã¡nh giÃ¡
DELETE /api/reviews/:id            XÃ³a Ä‘Ã¡nh giÃ¡
```

### AI & Chat
```
POST   /api/ai/chat                Chat vá»›i AI
POST   /api/ai/recommend           Gá»£i Ã½ phÃ²ng tá»« AI
POST   /api/ai/nlp-search          TÃ¬m kiáº¿m NLP
GET    /api/chat/conversations     Danh sÃ¡ch cuá»™c há»™i thoáº¡i
POST   /api/chat/messages          Gá»­i tin nháº¯n
```

### Admin
```
GET    /api/admin/stats            Thá»‘ng kÃª há»‡ thá»‘ng
GET    /api/admin/users            Quáº£n lÃ½ users
GET    /api/admin/properties       Quáº£n lÃ½ properties
PATCH  /api/admin/users/:id/block  Block user
```

**Xem chi tiáº¿t API**: Sá»­ dá»¥ng Postman hoáº·c kiá»ƒm tra file `src/routes/*.js`

---

## ğŸ¤– Machine Learning

### Price Prediction Model (XGBoost)

Dá»± Ä‘oÃ¡n giÃ¡ phÃ²ng há»£p lÃ½ dá»±a trÃªn:
- Vá»‹ trÃ­ (district, ward, city)
- Diá»‡n tÃ­ch (area)
- Tiá»‡n Ã­ch (wifi, AC, parking, kitchen...)
- Sá»‘ phÃ²ng ngá»§, phÃ²ng táº¯m
- Loáº¡i phÃ²ng

**Äá»™ chÃ­nh xÃ¡c**: RÂ² Score ~ 0.85

### Anomaly Detection (Isolation Forest)

PhÃ¡t hiá»‡n bÃ i Ä‘Äƒng báº¥t thÆ°á»ng:
- GiÃ¡ quÃ¡ tháº¥p/cao so vá»›i thá»‹ trÆ°á»ng
- Text quÃ¡ ngáº¯n hoáº·c spam
- Thiáº¿u thÃ´ng tin quan trá»ng
- TiÃªu Ä‘á»/mÃ´ táº£ chá»©a tá»« khÃ³a spam

### Training Models

```bash
cd ml-moderation/scripts

# CÃ¡ch 1: Cháº¡y tá»«ng bÆ°á»›c
python 1_data_preparation.py
python 2_train_price_model.py
python 3_train_anomaly_model.py

# CÃ¡ch 2: Cháº¡y táº¥t cáº£
python run_all.py
```

**LÆ°u Ã½**: Cáº§n cÃ³ MongoDB cháº¡y vÃ  cÃ³ dá»¯ liá»‡u properties trong database

---

## ğŸ‘¤ TÃ i Khoáº£n Demo

### User thÆ°á»ng
```
Email: user@example.com
Password: 123456
```

### Chá»§ nhÃ  (Landlord)
```
Email: landlord@example.com
Password: 123456
```

### Admin
```
Email: admin@example.com
Password: admin123
```

**LÆ°u Ã½**: TÃ i khoáº£n demo chá»‰ cÃ³ sau khi seed data

---

## ğŸ“¸ Screenshots

### Trang chá»§
![Homepage](docs/screenshots/homepage.png)

### TÃ¬m kiáº¿m phÃ²ng
![Search](docs/screenshots/search.png)

### Chi tiáº¿t phÃ²ng
![Property Detail](docs/screenshots/property-detail.png)

### Chat real-time
![Chat](docs/screenshots/chat.png)

### AI Chatbot
![Chatbot](docs/screenshots/chatbot.png)

### Admin Dashboard
![Admin](docs/screenshots/admin.png)

---

## ğŸ› Troubleshooting

### Lá»—i káº¿t ná»‘i MongoDB
```bash
# Kiá»ƒm tra MongoDB Ä‘ang cháº¡y
mongosh
# hoáº·c
mongo
```

### Lá»—i "Module not found"
```bash
# XÃ³a node_modules vÃ  cÃ i láº¡i
rm -rf node_modules package-lock.json
npm install
```

### Lá»—i upload áº£nh
- Kiá»ƒm tra Cloudinary credentials trong `.env`
- Kiá»ƒm tra internet connection

### Lá»—i AI khÃ´ng pháº£n há»“i
- Kiá»ƒm tra API keys (Gemini, Groq)
- Kiá»ƒm tra quota API cÃ²n khÃ´ng

### Port Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng
```bash
# Thay Ä‘á»•i PORT trong .env
PORT=3001
```

---

## ğŸ”’ Security

- âœ… JWT token httpOnly cookies
- âœ… Bcrypt password hashing
- âœ… Helmet.js security headers
- âœ… Rate limiting (100 req/15 min)
- âœ… CORS protection
- âœ… Input validation & sanitization
- âœ… XSS protection
- âœ… MongoDB injection prevention

---

## ğŸ“ To-Do List

- [ ] TÃ­ch há»£p thanh toÃ¡n (Momo, ZaloPay, VNPay)
- [ ] Unit testing (Jest, Mocha)
- [ ] API documentation (Swagger/OpenAPI)
- [ ] Docker containerization
- [ ] CI/CD pipeline (GitHub Actions)
- [ ] Performance optimization
- [ ] SEO optimization
- [ ] Mobile app (React Native)
- [ ] Admin analytics dashboard
- [ ] Email verification
- [ ] Forgot password functionality
- [ ] Social media sharing

---

## ğŸ¤ Contributing

Contributions, issues vÃ  feature requests Ä‘á»u Ä‘Æ°á»£c chÃ o Ä‘Ã³n!

1. Fork dá»± Ã¡n
2. Táº¡o branch má»›i (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Má»Ÿ Pull Request

---

## ğŸ“„ License

Dá»± Ã¡n nÃ y Ä‘Æ°á»£c cáº¥p phÃ©p theo giáº¥y phÃ©p **MIT License** - xem file [LICENSE](LICENSE) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.

---

## ğŸ‘¨â€ğŸ’» Author

**KH20042004**
- GitHub: [@kh20042004](https://github.com/kh20042004)
- Email: contact@example.com

---

## ğŸ™ Acknowledgments

- [Node.js](https://nodejs.org/)
- [Express.js](https://expressjs.com/)
- [MongoDB](https://www.mongodb.com/)
- [Google Gemini](https://ai.google.dev/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Socket.IO](https://socket.io/)
- [Cloudinary](https://cloudinary.com/)
- [Goong Maps](https://goong.io/)

---

## ğŸ“ Support

Náº¿u báº¡n thÃ­ch dá»± Ã¡n nÃ y, hÃ£y cho má»™t â­ï¸!

CÃ³ váº¥n Ä‘á»? [Má»Ÿ issue](https://github.com/kh20042004/QLChoThueTro/issues)

---

<div align="center">

**Made with â¤ï¸ in Vietnam**

</div>
